%%%-------------------------------------------------------------------
%%% @author Ralf Th. Pietsch
%%% @copyright (C) 2022, Ralf Th. Pietsch
%%% @doc
%%%
%%% @end
%%% Created : 02. Feb 2022 20:27
%%%-------------------------------------------------------------------
-module(ps_db_SUITE).
-author("Ralf Th. Pietsch").

-include_lib("common_test/include/ct.hrl").

%% Test cases
-export([find_one/1, find_none/1]).

%% Test server callbacks
-export([suite/0, all/0, init_per_suite/1, end_per_suite/1, init_per_testcase/2, end_per_testcase/2]).

-define(CONNECT_STR, "DSN=sqlserver;UID=alladin;PWD=sesame").

%%%===================================================================
%%% COMMON TEST CALLBACK FUNCTIONS
%%%===================================================================

all() ->
	[
		find_one,
		find_none
	].


suite() ->
	[].


init_per_suite(Config) ->
	Config.


end_per_suite(_Config) ->
	ok.


init_per_testcase(_Case, Config) ->
	Config.


end_per_testcase(_Case, Config) ->
	ok.

%%%===================================================================
%%% TEST CASES
%%%===================================================================

find_one(_Config) ->
	DB = ps_db:new(test_data()),
	Plz = <<"60599">>,
	{ok, {Plz, _Name, {_, _}}} = ps_db:get_by_plz(DB, Plz).

find_none(_Config) ->
	DB = ps_db:new(test_data()),
	Plz = <<"70599">>,
	not_found = ps_db:get_by_plz(DB, Plz).


%%%===================================================================
%%% Internal functions
%%%===================================================================

test_data() ->
	[
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1128925469803">>, <<"loc_id">> => <<"153642">>,
			<<"lon">> => <<"8.64971079502703">>, <<"plz">> => <<"60306">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1128925469803">>, <<"loc_id">> => <<"9013">>,
			<<"lon">> => <<"8.64971079502703">>, <<"plz">> => <<"60308">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1128925469803">>, <<"loc_id">> => <<"153668">>,
			<<"lon">> => <<"8.64971079502703">>, <<"plz">> => <<"60310">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1119739847457">>, <<"loc_id">> => <<"9014">>,
			<<"lon">> => <<"8.68388595191705">>, <<"plz">> => <<"60311">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1163403772999">>, <<"loc_id">> => <<"9015">>,
			<<"lon">> => <<"8.68150701860773">>, <<"plz">> => <<"60313">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1149369658203">>, <<"loc_id">> => <<"9016">>,
			<<"lon">> => <<"8.72387525923887">>, <<"plz">> => <<"60314">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1203720202354">>, <<"loc_id">> => <<"9017">>,
			<<"lon">> => <<"8.69702981904918">>, <<"plz">> => <<"60316">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1252950476291">>, <<"loc_id">> => <<"9018">>,
			<<"lon">> => <<"8.68615456890977">>, <<"plz">> => <<"60318">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1385134658647">>, <<"loc_id">> => <<"9019">>,
			<<"lon">> => <<"8.67797920336803">>, <<"plz">> => <<"60320">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1277415529623">>, <<"loc_id">> => <<"9020">>,
			<<"lon">> => <<"8.67723462146381">>, <<"plz">> => <<"60322">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1241893600359">>, <<"loc_id">> => <<"9021">>,
			<<"lon">> => <<"8.66508446666327">>, <<"plz">> => <<"60323">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1160432047764">>, <<"loc_id">> => <<"9022">>,
			<<"lon">> => <<"8.65914207218513">>, <<"plz">> => <<"60325">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1039559080106">>, <<"loc_id">> => <<"9023">>,
			<<"lon">> => <<"8.62814241027007">>, <<"plz">> => <<"60326">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1000498740008">>, <<"loc_id">> => <<"9024">>,
			<<"lon">> => <<"8.64460204440491">>, <<"plz">> => <<"60327">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1080991245413">>, <<"loc_id">> => <<"9025">>,
			<<"lon">> => <<"8.66758572293455">>, <<"plz">> => <<"60329">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1251438011601">>, <<"loc_id">> => <<"9026">>,
			<<"lon">> => <<"8.7149289566039 ">>, <<"plz">> => <<"60385">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1281415268096">>, <<"loc_id">> => <<"9027">>,
			<<"lon">> => <<"8.7549316755944 ">>, <<"plz">> => <<"60386">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1583151705762">>, <<"loc_id">> => <<"9028">>,
			<<"lon">> => <<"8.7633722053987 ">>, <<"plz">> => <<"60388">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1474893964226">>, <<"loc_id">> => <<"9029">>,
			<<"lon">> => <<"8.71764650491017">>, <<"plz">> => <<"60389">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1464210307454">>, <<"loc_id">> => <<"9030">>,
			<<"lon">> => <<"8.65048933442817">>, <<"plz">> => <<"60431">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1649568462107">>, <<"loc_id">> => <<"9031">>,
			<<"lon">> => <<"8.66895406757212">>, <<"plz">> => <<"60433">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1599064731613">>, <<"loc_id">> => <<"9032">>,
			<<"lon">> => <<"8.6968041308203 ">>, <<"plz">> => <<"60435">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1992173      ">>, <<"loc_id">> => <<"9033">>,
			<<"lon">> => <<"8.6789656       ">>, <<"plz">> => <<"60437">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1787532      ">>, <<"loc_id">> => <<"153644">>,
			<<"lon">> => <<"8.6271394       ">>, <<"plz">> => <<"60438">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1642650864069">>, <<"loc_id">> => <<"9034">>,
			<<"lon">> => <<"8.62367714534153">>, <<"plz">> => <<"60439">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1170710792954">>, <<"loc_id">> => <<"9035">>,
			<<"lon">> => <<"8.62518454461255">>, <<"plz">> => <<"60486">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1309723300128">>, <<"loc_id">> => <<"9036">>,
			<<"lon">> => <<"8.64761238742544">>, <<"plz">> => <<"60487">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1419423225987">>, <<"loc_id">> => <<"9037">>,
			<<"lon">> => <<"8.61531856620664">>, <<"plz">> => <<"60488">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1263940837884">>, <<"loc_id">> => <<"9038">>,
			<<"lon">> => <<"8.60462075288717">>, <<"plz">> => <<"60489">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.0697465663836">>, <<"loc_id">> => <<"9039">>,
			<<"lon">> => <<"8.64043359403053">>, <<"plz">> => <<"60528">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.0799834227198">>, <<"loc_id">> => <<"9040">>,
			<<"lon">> => <<"8.58063349439832">>, <<"plz">> => <<"60529">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.043497897551">>, <<"loc_id">> => <<"9041">>,
			<<"lon">> => <<"8.56746709823779">>, <<"plz">> => <<"60549">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.1054422497714">>, <<"loc_id">> => <<"9042">>,
			<<"lon">> => <<"8.68956125908783">>, <<"plz">> => <<"60594">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.0978869751565">>, <<"loc_id">> => <<"9043">>,
			<<"lon">> => <<"8.67094420223635">>, <<"plz">> => <<"60596">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.0813832108829">>, <<"loc_id">> => <<"9044">>,
			<<"lon">> => <<"8.67909002459541">>, <<"plz">> => <<"60598">>},
		#{<<"Ort">> => <<"Frankfurt am Main">>,
			<<"lat">> => <<"50.086608543744">>, <<"loc_id">> => <<"9045">>,
			<<"lon">> => <<"8.71529986677625">>, <<"plz">> => <<"60599">>}
	].